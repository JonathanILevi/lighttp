<!DOCTYPE html>
<html>
	<head>
		<title>Chatroom using lighttp's websockets</title>
		<script>
			function join(room, username) {
				var ws = new WebSocket("ws://" + location.host + "/room/" + room + "@" + username);
				ws.onopen = function(){
					document.body.innerHTML = "<div id='messages'></div><input id='message' /><button id='send'>Send</button>";
					var send = function(){
						var message = document.getElementById("message");
						if(message.value.length > 0) {
							ws.send(message.value);
							message.value = "";
						}
					};
					document.getElementById("send").onclick = send;
					document.getElementById("message").onkeydown = function(event){
						if(event.keyCode == 13) send();
					}
				}
				ws.onmessage = function(message){
					var json = JSON.parse(message.data);
					var mx = (function(){
						switch(json.type) {
							case "join":
								return json.user.name + " joined";
							case "leave":
								return json.user.name + " left";
							case "message":
								return json.user.name + ": " + json.message;
						}
					})();
					document.getElementById("messages").innerHTML += "<p>" + mx + "</p>";
				}
			}
		</script>
	</head>
	<body>
		<input placeholder="room" />
		<input placeholder="name" />
		<button onclick="join(document.getElementsByTagName('input')[0].value, document.getElementsByTagName('input')[1].value)">Connect</button>
	</body>
</html>
